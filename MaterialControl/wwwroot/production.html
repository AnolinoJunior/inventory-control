<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Production Suggestion</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Production Suggestion</h1>
<a href="index.html">‚Üê Back to Home</a>

<div id="loading">Loading production suggestion...</div>
<p>Total Production Value: <span id="total">$0.00</span></p>
<ul id="suggestionList" style="display:none;"></ul>

<script>
const API_BASE = 'https://localhost:44340';

async function loadSuggestion() {
  try {
    console.log('Fetching production from:', `${API_BASE}/api/production/suggestion`);
    
    const res = await fetch(`${API_BASE}/api/production/suggestion`);
    console.log('Response status:', res.status);
    
    if (!res.ok) {
      throw new Error(`HTTP ${res.status}: ${await res.text()}`);
    }
    
    const data = await res.json();
    console.log('Production data:', data);
    
    document.getElementById("total").textContent = `$${data.totalProductionValue?.toFixed(2) || '0.00'}`;
    document.getElementById("loading").style.display = 'none';
    
    const list = document.getElementById("suggestionList");
    list.style.display = 'block';
    list.innerHTML = "";
    
    if (data.products && data.products.length > 0) {
      data.products.forEach(p => {
        const li = document.createElement("li");
        li.textContent = `${p.productName || 'Product'} - ${p.quantity || 0} units - Total: $${(p.totalValue || 0).toFixed(2)}`;
        list.appendChild(li);
      });
    } else {
      list.innerHTML = '<li>No products can be produced with current stock</li>';
    }
    
  } catch (error) {
    console.error('Error details:', error);
    document.getElementById("loading").innerHTML = 
      `Error: ${error.message}<br>
       <button onclick="loadSuggestion()">Try Again</button>`;
  }
}

loadSuggestion();
</script>
</body>
</html>