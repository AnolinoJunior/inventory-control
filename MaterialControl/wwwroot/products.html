<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Products</h1>
    <a href="index.html">← Back to Home</a>
    
    <div id="loading">Loading products...</div>
    <ul id="productsList" style="display:none;"></ul>

    <script>
        const API_BASE = 'https://localhost:44340';
        
        async function loadProducts() {
            try {
                console.log('Fetching from:', `${API_BASE}/api/products`);
                
                const response = await fetch(`${API_BASE}/api/products`);
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }
                
                const products = await response.json();
                console.log('Products received:', products);
                
                const ul = document.getElementById('productsList');
                const loading = document.getElementById('loading');
                
                if (products.length === 0) {
                    loading.innerHTML = 'No products found';
                    return;
                }
                
                ul.innerHTML = '';
                products.forEach(p => {
                    const li = document.createElement('li');
                    li.textContent = `${p.code || p.name} - $${p.price || 0}`;
                    ul.appendChild(li);
                });
                
                loading.style.display = 'none';
                ul.style.display = 'block';
                
            } catch (error) {
                console.error('Error details:', error);
                document.getElementById('loading').innerHTML = 
                    `Error: ${error.message}<br>
                     <button onclick="loadProducts()">Try Again</button>`;
            }
        }

        // Teste rápido no console
        console.log('Testing API connection...');
        fetch(`${API_BASE}/api/products`)
            .then(r => console.log('Test result:', r.status))
            .catch(err => console.error('Test failed:', err));

        loadProducts();
    </script>
</body>
</html>